from PIL import Image
import os
import time

def crack(cap_name):


    img = Image.open('/media/ekowibowo/26592CCE5A7BE4B62/CODE/JOB/m2/Try/1533/example4/Files/'+cap_name+'.jpg')
    img = img.convert("RGB")
    pixdata = img.load()
    for y in xrange(img.size[1]):
        for x in xrange(img.size[0]):
            if pixdata[x, y][0] < 90:
                pixdata[x, y] = (0, 0, 0, 255)
    for y in xrange(img.size[1]):
        for x in xrange(img.size[0]):
            if pixdata[x, y][1] < 136:
                pixdata[x, y] = (0, 0, 0, 255)
    for y in xrange(img.size[1]):
        for x in xrange(img.size[0]):
            if pixdata[x, y][2] > 0:
                pixdata[x, y] = (255, 255, 255, 255)
    ext = ".tif"
    img.save("/media/ekowibowo/26592CCE5A7BE4B62/CODE/JOB/m2/Try/1533/example4/Files/"+cap_name + ext)


    command = "tesseract -psm 7 /media/ekowibowo/26592CCE5A7BE4B62/CODE/JOB/m2/Try/1533/example4/Files/"+cap_name +".tif "+"/media/ekowibowo/26592CCE5A7BE4B62/CODE/JOB/m2/Try/1533/example4/Files/text"
    os.system(command)
    time.sleep(1)


    Text  = open ("/media/ekowibowo/26592CCE5A7BE4B62/CODE/JOB/m2/Try/1533/example4/Files/text.txt","r")
    decoded = Text.readline().strip('\n')
    if decoded.isdigit():
        print '[+}CAPTCHA number are ' + decoded
    else:
        print decoded


def main():

    getlist = os.listdir("/media/ekowibowo/26592CCE5A7BE4B62/CODE/JOB/m2/Try/1533/example4/Files/")
    number = int (len(getlist))
    for cap in range(1,number+1):
        print cap
        crack(str(cap))

main()
